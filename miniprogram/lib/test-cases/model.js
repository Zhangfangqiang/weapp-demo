import{registerGLTFLoader}from"../loaders/gltf-loader";import registerOrbit from"./orbit";export function renderModel(i,s){registerGLTFLoader(s);var e,t,o,n,l,d,m,a;var c,p,f,g,u,h;var r={state:"Walking"};v();x();function v(){c=new s.PerspectiveCamera(45,i.width/i.height,.25,100);c.position.set(-5,3,10);c.lookAt(new s.Vector3(0,2,0));p=new s.Scene;p.background=new s.Color(14737632);p.fog=new s.Fog(14737632,20,100);o=new s.Clock;var e=new s.HemisphereLight(16777215,4473924);e.position.set(0,20,0);p.add(e);e=new s.DirectionalLight(16777215);e.position.set(0,20,10);p.add(e);var t=new s.Mesh(new s.PlaneBufferGeometry(2e3,2e3),new s.MeshPhongMaterial({color:10066329,depthWrite:false}));t.rotation.x=-Math.PI/2;p.add(t);var n=new s.GridHelper(200,40,0,0);n.material.opacity=.2;n.material.transparent=true;p.add(n);var a=new s.GLTFLoader;a.load("https://threejs.org/examples/models/gltf/RobotExpressive/RobotExpressive.glb",function(e){g=e.scene;p.add(g);w(g,e.animations)},undefined,function(e){console.error(e)});f=new s.WebGLRenderer({antialias:true});f.setPixelRatio(wx.getSystemInfoSync().pixelRatio);f.setSize(i.width,i.height);f.gammaOutput=true;f.gammaFactor=2.2;const{OrbitControls:r}=registerOrbit(s);h=new r(c,f.domElement);c.position.set(5,5,10);h.update()}function w(e,t){var n=["Idle","Walking","Running","Dance","Death","Sitting","Standing"];var a=["Jump","Yes","No","Wave","Punch","ThumbsUp"];l=new s.AnimationMixer(e);d={};for(var r=0;r<t.length;r++){var i=t[r];var o=l.clipAction(i);d[i.name]=o;if(a.indexOf(i.name)>=0||n.indexOf(i.name)>=4){o.clampWhenFinished=true;o.loop=s.LoopOnce}console.log("clip.name",i.name)}u=e.getObjectByName("Head_2");m=d["WalkJump"];m.play()}function b(e,t=1){a=m;m=d[e];if(a!==m){a.fadeOut(t)}m.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(t).play()}function x(){var e=o.getDelta();if(l)l.update(e);i.requestAnimationFrame(x);h.update();f.render(p,c)}return b}