import{EventDispatcher,MOUSE,Quaternion,Spherical,TOUCH,Vector2,Vector3,global as window}from"../../libs/three.weapp.js";var OrbitControls=function(e,t){this.object=e;this.domElement=t!==undefined?t:document;this.enabled=true;this.target=new Vector3;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=false;this.dampingFactor=.05;this.enableZoom=true;this.zoomSpeed=1;this.enableRotate=true;this.rotateSpeed=1;this.enablePan=true;this.panSpeed=1;this.screenSpacePanning=false;this.keyPanSpeed=7;this.autoRotate=false;this.autoRotateSpeed=2;this.enableKeys=true;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN};this.touches={ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN};this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;this.getPolarAngle=function(){return f.phi};this.getAzimuthalAngle=function(){return f.theta};this.saveState=function(){i.target0.copy(i.target);i.position0.copy(i.object.position);i.zoom0=i.object.zoom};this.reset=function(){i.target.copy(i.target0);i.object.position.copy(i.position0);i.object.zoom=i.zoom0;i.object.updateProjectionMatrix();i.dispatchEvent(c);i.update();u=l.NONE};this.update=function(){var a=new Vector3;var n=(new Quaternion).setFromUnitVectors(e.up,new Vector3(0,1,0));var o=n.clone().inverse();var r=new Vector3;var s=new Quaternion;return function e(){var t=i.object.position;a.copy(t).sub(i.target);a.applyQuaternion(n);f.setFromVector3(a);if(i.autoRotate&&u===l.NONE){A(P())}if(i.enableDamping){f.theta+=p.theta*i.dampingFactor;f.phi+=p.phi*i.dampingFactor}else{f.theta+=p.theta;f.phi+=p.phi}f.theta=Math.max(i.minAzimuthAngle,Math.min(i.maxAzimuthAngle,f.theta));f.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,f.phi));f.makeSafe();f.radius*=h;f.radius=Math.max(i.minDistance,Math.min(i.maxDistance,f.radius));if(i.enableDamping===true){i.target.addScaledVector(d,i.dampingFactor)}else{i.target.add(d)}a.setFromSpherical(f);a.applyQuaternion(o);t.copy(i.target).add(a);i.object.lookAt(i.target);if(i.enableDamping===true){p.theta*=1-i.dampingFactor;p.phi*=1-i.dampingFactor;d.multiplyScalar(1-i.dampingFactor)}else{p.set(0,0,0);d.set(0,0,0)}h=1;if(b||r.distanceToSquared(i.object.position)>m||8*(1-s.dot(i.object.quaternion))>m){i.dispatchEvent(c);r.copy(i.object.position);s.copy(i.object.quaternion);b=false;return true}return false}}();this.dispose=function(){i.domElement.removeEventListener("contextmenu",se,false);i.domElement.removeEventListener("mousedown",J,false);i.domElement.removeEventListener("wheel",te,false);i.domElement.removeEventListener("touchstart",ne,false);i.domElement.removeEventListener("touchend",re,false);i.domElement.removeEventListener("touchmove",oe,false);document.removeEventListener("mousemove",$,false);document.removeEventListener("mouseup",ee,false);window.removeEventListener("keydown",ae,false)};var i=this;var c={type:"change"};var a={type:"start"};var n={type:"end"};var l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};var u=l.NONE;var m=1e-6;var f=new Spherical;var p=new Spherical;var h=1;var d=new Vector3;var b=false;var o=new Vector2;var r=new Vector2;var s=new Vector2;var v=new Vector2;var E=new Vector2;var O=new Vector2;var g=new Vector2;var T=new Vector2;var y=new Vector2;function P(){return 2*Math.PI/60/60*i.autoRotateSpeed}function N(){return Math.pow(.95,i.zoomSpeed)}function A(e){p.theta-=e}function L(e){p.phi-=e}var w=function(){var n=new Vector3;return function e(t,a){n.setFromMatrixColumn(a,0);n.multiplyScalar(-t);d.add(n)}}();var j=function(){var n=new Vector3;return function e(t,a){if(i.screenSpacePanning===true){n.setFromMatrixColumn(a,1)}else{n.setFromMatrixColumn(a,0);n.crossVectors(i.object.up,n)}n.multiplyScalar(t);d.add(n)}}();var M=function(){var s=new Vector3;return function e(t,a){var n=i.domElement===document?i.domElement.body:i.domElement;if(i.object.isPerspectiveCamera){var o=i.object.position;s.copy(o).sub(i.target);var r=s.length();r*=Math.tan(i.object.fov/2*Math.PI/180);w(2*t*r/n.clientHeight,i.object.matrix);j(2*a*r/n.clientHeight,i.object.matrix)}else if(i.object.isOrthographicCamera){w(t*(i.object.right-i.object.left)/i.object.zoom/n.clientWidth,i.object.matrix);j(a*(i.object.top-i.object.bottom)/i.object.zoom/n.clientHeight,i.object.matrix)}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.");i.enablePan=false}}}();function C(e){if(i.object.isPerspectiveCamera){h/=e}else if(i.object.isOrthographicCamera){i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e));i.object.updateProjectionMatrix();b=true}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.");i.enableZoom=false}}function S(e){if(i.object.isPerspectiveCamera){h*=e}else if(i.object.isOrthographicCamera){i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e));i.object.updateProjectionMatrix();b=true}else{console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.");i.enableZoom=false}}function k(e){o.set(e.clientX,e.clientY)}function R(e){g.set(e.clientX,e.clientY)}function Y(e){v.set(e.clientX,e.clientY)}function D(e){r.set(e.clientX,e.clientY);s.subVectors(r,o).multiplyScalar(i.rotateSpeed);var t=i.domElement===document?i.domElement.body:i.domElement;A(2*Math.PI*s.x/t.clientHeight);L(2*Math.PI*s.y/t.clientHeight);o.copy(r);i.update()}function U(e){T.set(e.clientX,e.clientY);y.subVectors(T,g);if(y.y>0){C(N())}else if(y.y<0){S(N())}g.copy(T);i.update()}function H(e){E.set(e.clientX,e.clientY);O.subVectors(E,v).multiplyScalar(i.panSpeed);M(O.x,O.y);v.copy(E);i.update()}function x(){}function V(e){if(e.deltaY<0){S(N())}else if(e.deltaY>0){C(N())}i.update()}function z(e){var t=false;switch(e.keyCode){case i.keys.UP:M(0,i.keyPanSpeed);t=true;break;case i.keys.BOTTOM:M(0,-i.keyPanSpeed);t=true;break;case i.keys.LEFT:M(i.keyPanSpeed,0);t=true;break;case i.keys.RIGHT:M(-i.keyPanSpeed,0);t=true;break}if(t){e.preventDefault();i.update()}}function X(e){if(e.touches.length==1){o.set(e.touches[0].pageX,e.touches[0].pageY)}else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX);var a=.5*(e.touches[0].pageY+e.touches[1].pageY);o.set(t,a)}}function _(e){if(e.touches.length==1){v.set(e.touches[0].pageX,e.touches[0].pageY)}else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX);var a=.5*(e.touches[0].pageY+e.touches[1].pageY);v.set(t,a)}}function I(e){var t=e.touches[0].pageX-e.touches[1].pageX;var a=e.touches[0].pageY-e.touches[1].pageY;var n=Math.sqrt(t*t+a*a);g.set(0,n)}function Z(e){if(i.enableZoom)I(e);if(i.enablePan)_(e)}function F(e){if(i.enableZoom)I(e);if(i.enableRotate)X(e)}function B(e){if(e.touches.length==1){r.set(e.touches[0].pageX,e.touches[0].pageY)}else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX);var a=.5*(e.touches[0].pageY+e.touches[1].pageY);r.set(t,a)}s.subVectors(r,o).multiplyScalar(i.rotateSpeed);var n=i.domElement===document?i.domElement.body:i.domElement;A(2*Math.PI*s.x/n.clientHeight);L(2*Math.PI*s.y/n.clientHeight);o.copy(r)}function G(e){if(e.touches.length==1){E.set(e.touches[0].pageX,e.touches[0].pageY)}else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX);var a=.5*(e.touches[0].pageY+e.touches[1].pageY);E.set(t,a)}O.subVectors(E,v).multiplyScalar(i.panSpeed);M(O.x,O.y);v.copy(E)}function K(e){var t=e.touches[0].pageX-e.touches[1].pageX;var a=e.touches[0].pageY-e.touches[1].pageY;var n=Math.sqrt(t*t+a*a);T.set(0,n);y.set(0,Math.pow(T.y/g.y,i.zoomSpeed));C(y.y);g.copy(T)}function W(e){if(i.enableZoom)K(e);if(i.enablePan)G(e)}function q(e){if(i.enableZoom)K(e);if(i.enableRotate)B(e)}function Q(){}function J(e){if(i.enabled===false)return;e.preventDefault();i.domElement.focus?i.domElement.focus():window.focus();switch(e.button){case 0:switch(i.mouseButtons.LEFT){case MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(i.enablePan===false)return;Y(e);u=l.PAN}else{if(i.enableRotate===false)return;k(e);u=l.ROTATE}break;case MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(i.enableRotate===false)return;k(e);u=l.ROTATE}else{if(i.enablePan===false)return;Y(e);u=l.PAN}break;default:u=l.NONE}break;case 1:switch(i.mouseButtons.MIDDLE){case MOUSE.DOLLY:if(i.enableZoom===false)return;R(e);u=l.DOLLY;break;default:u=l.NONE}break;case 2:switch(i.mouseButtons.RIGHT){case MOUSE.ROTATE:if(i.enableRotate===false)return;k(e);u=l.ROTATE;break;case MOUSE.PAN:if(i.enablePan===false)return;Y(e);u=l.PAN;break;default:u=l.NONE}break}if(u!==l.NONE){document.addEventListener("mousemove",$,false);document.addEventListener("mouseup",ee,false);i.dispatchEvent(a)}}function $(e){if(i.enabled===false)return;e.preventDefault();switch(u){case l.ROTATE:if(i.enableRotate===false)return;D(e);break;case l.DOLLY:if(i.enableZoom===false)return;U(e);break;case l.PAN:if(i.enablePan===false)return;H(e);break}}function ee(e){if(i.enabled===false)return;x(e);document.removeEventListener("mousemove",$,false);document.removeEventListener("mouseup",ee,false);i.dispatchEvent(n);u=l.NONE}function te(e){if(i.enabled===false||i.enableZoom===false||u!==l.NONE&&u!==l.ROTATE)return;e.preventDefault();e.stopPropagation();i.dispatchEvent(a);V(e);i.dispatchEvent(n)}function ae(e){if(i.enabled===false||i.enableKeys===false||i.enablePan===false)return;z(e)}function ne(e){if(i.enabled===false)return;e.preventDefault();switch(e.touches.length){case 1:switch(i.touches.ONE){case TOUCH.ROTATE:if(i.enableRotate===false)return;X(e);u=l.TOUCH_ROTATE;break;case TOUCH.PAN:if(i.enablePan===false)return;_(e);u=l.TOUCH_PAN;break;default:u=l.NONE}break;case 2:switch(i.touches.TWO){case TOUCH.DOLLY_PAN:if(i.enableZoom===false&&i.enablePan===false)return;Z(e);u=l.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(i.enableZoom===false&&i.enableRotate===false)return;F(e);u=l.TOUCH_DOLLY_ROTATE;break;default:u=l.NONE}break;default:u=l.NONE}if(u!==l.NONE){i.dispatchEvent(a)}}function oe(e){if(i.enabled===false)return;e.preventDefault();e.stopPropagation();switch(u){case l.TOUCH_ROTATE:if(i.enableRotate===false)return;B(e);i.update();break;case l.TOUCH_PAN:if(i.enablePan===false)return;G(e);i.update();break;case l.TOUCH_DOLLY_PAN:if(i.enableZoom===false&&i.enablePan===false)return;W(e);i.update();break;case l.TOUCH_DOLLY_ROTATE:if(i.enableZoom===false&&i.enableRotate===false)return;q(e);i.update();break;default:u=l.NONE}}function re(e){if(i.enabled===false)return;Q(e);i.dispatchEvent(n);u=l.NONE}function se(e){if(i.enabled===false)return;e.preventDefault()}i.domElement.addEventListener("contextmenu",se,false);i.domElement.addEventListener("mousedown",J,false);i.domElement.addEventListener("wheel",te,false);i.domElement.addEventListener("touchstart",ne,false);i.domElement.addEventListener("touchend",re,false);i.domElement.addEventListener("touchmove",oe,false);window.addEventListener("keydown",ae,false);this.update()};OrbitControls.prototype=Object.create(EventDispatcher.prototype);OrbitControls.prototype.constructor=OrbitControls;var MapControls=function(e,t){OrbitControls.call(this,e,t);this.mouseButtons.LEFT=MOUSE.PAN;this.mouseButtons.RIGHT=MOUSE.ROTATE;this.touches.ONE=TOUCH.PAN;this.touches.TWO=TOUCH.DOLLY_ROTATE};MapControls.prototype=Object.create(EventDispatcher.prototype);MapControls.prototype.constructor=MapControls;export{OrbitControls,MapControls};