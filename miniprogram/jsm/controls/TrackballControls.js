export default function(e){let{EventDispatcher:t,MOUSE:Y,Quaternion:x,Vector2:X,Vector3:Z,global:S}=e;let H=S.document;var o=function(e,t){if(t===undefined)console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.');if(t===H)console.error('THREE.TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');var c=this;var s={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e;this.domElement=t;this.enabled=true;this.screen={left:0,top:0,width:0,height:0};this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.noRotate=false;this.noZoom=false;this.noPan=false;this.staticMoving=false;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.mouseButtons={LEFT:Y.ROTATE,MIDDLE:Y.ZOOM,RIGHT:Y.PAN};this.target=new Z;var o=1e-6;var n=new Z;var a=1;var i=s.NONE,r=s.NONE,p=new Z,l=new X,u=new X,h=new Z,d=0,m=new X,f=new X,v=0,g=0,E=new X,b=new X;this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();this.zoom0=this.object.zoom;var y={type:"change"};var O={type:"start"};var j={type:"end"};this.handleResize=function(){var e=this.domElement.getBoundingClientRect();var t=H.documentElement;this.screen.left=e.left+S.scrollX-t.clientLeft;this.screen.top=e.top+S.scrollY-t.clientTop;this.screen.width=e.width;this.screen.height=e.height};var w=function(){var n=new X;return function e(t,o){n.set((t-c.screen.left)/c.screen.width,(o-c.screen.top)/c.screen.height);return n}}();var T=function(){var n=new X;return function e(t,o){n.set((t-c.screen.width*.5-c.screen.left)/(c.screen.width*.5),(c.screen.height+2*(c.screen.top-o))/c.screen.width);return n}}();this.rotateCamera=function(){var t=new Z,o=new x,n=new Z,a=new Z,s=new Z,i=new Z,r;return function e(){i.set(u.x-l.x,u.y-l.y,0);r=i.length();if(r){p.copy(c.object.position).sub(c.target);n.copy(p).normalize();a.copy(c.object.up).normalize();s.crossVectors(a,n).normalize();a.setLength(u.y-l.y);s.setLength(u.x-l.x);i.copy(a.add(s));t.crossVectors(i,p).normalize();r*=c.rotateSpeed;o.setFromAxisAngle(t,r);p.applyQuaternion(o);c.object.up.applyQuaternion(o);h.copy(t);d=r}else if(!c.staticMoving&&d){d*=Math.sqrt(1-c.dynamicDampingFactor);p.copy(c.object.position).sub(c.target);o.setFromAxisAngle(h,d);p.applyQuaternion(o);c.object.up.applyQuaternion(o)}l.copy(u)}}();this.zoomCamera=function(){var e;if(i===s.TOUCH_ZOOM_PAN){e=v/g;v=g;if(c.object.isPerspectiveCamera){p.multiplyScalar(e)}else if(c.object.isOrthographicCamera){c.object.zoom*=e;c.object.updateProjectionMatrix()}else{console.warn("THREE.TrackballControls: Unsupported camera type")}}else{e=1+(f.y-m.y)*c.zoomSpeed;if(e!==1&&e>0){if(c.object.isPerspectiveCamera){p.multiplyScalar(e)}else if(c.object.isOrthographicCamera){c.object.zoom/=e;c.object.updateProjectionMatrix()}else{console.warn("THREE.TrackballControls: Unsupported camera type")}}if(c.staticMoving){m.copy(f)}else{m.y+=(f.y-m.y)*this.dynamicDampingFactor}}};this.panCamera=function(){var n=new X,a=new Z,s=new Z;return function e(){n.copy(b).sub(E);if(n.lengthSq()){if(c.object.isOrthographicCamera){var t=(c.object.right-c.object.left)/c.object.zoom/c.domElement.clientWidth;var o=(c.object.top-c.object.bottom)/c.object.zoom/c.domElement.clientWidth;n.x*=t;n.y*=o}n.multiplyScalar(p.length()*c.panSpeed);s.copy(p).cross(c.object.up).setLength(n.x);s.add(a.copy(c.object.up).setLength(n.y));c.object.position.add(s);c.target.add(s);if(c.staticMoving){E.copy(b)}else{E.add(n.subVectors(b,E).multiplyScalar(c.dynamicDampingFactor))}}}}();this.checkDistances=function(){if(!c.noZoom||!c.noPan){if(p.lengthSq()>c.maxDistance*c.maxDistance){c.object.position.addVectors(c.target,p.setLength(c.maxDistance));m.copy(f)}if(p.lengthSq()<c.minDistance*c.minDistance){c.object.position.addVectors(c.target,p.setLength(c.minDistance));m.copy(f)}}};this.update=function(){p.subVectors(c.object.position,c.target);if(!c.noRotate){c.rotateCamera()}if(!c.noZoom){c.zoomCamera()}if(!c.noPan){c.panCamera()}c.object.position.addVectors(c.target,p);if(c.object.isPerspectiveCamera){c.checkDistances();c.object.lookAt(c.target);if(n.distanceToSquared(c.object.position)>o){c.dispatchEvent(y);n.copy(c.object.position)}}else if(c.object.isOrthographicCamera){c.object.lookAt(c.target);if(n.distanceToSquared(c.object.position)>o||a!==c.object.zoom){c.dispatchEvent(y);n.copy(c.object.position);a=c.object.zoom}}else{console.warn("THREE.TrackballControls: Unsupported camera type")}};this.reset=function(){i=s.NONE;r=s.NONE;c.target.copy(c.target0);c.object.position.copy(c.position0);c.object.up.copy(c.up0);c.object.zoom=c.zoom0;c.object.updateProjectionMatrix();p.subVectors(c.object.position,c.target);c.object.lookAt(c.target);c.dispatchEvent(y);n.copy(c.object.position);a=c.object.zoom};function k(e){if(c.enabled===false)return;S.removeEventListener("keydown",k);if(r!==s.NONE){return}else if(e.keyCode===c.keys[s.ROTATE]&&!c.noRotate){r=s.ROTATE}else if(e.keyCode===c.keys[s.ZOOM]&&!c.noZoom){r=s.ZOOM}else if(e.keyCode===c.keys[s.PAN]&&!c.noPan){r=s.PAN}}function N(){if(c.enabled===false)return;r=s.NONE;S.addEventListener("keydown",k,false)}function L(e){if(c.enabled===false)return;e.preventDefault();e.stopPropagation();if(i===s.NONE){switch(e.button){case c.mouseButtons.LEFT:i=s.ROTATE;break;case c.mouseButtons.MIDDLE:i=s.ZOOM;break;case c.mouseButtons.RIGHT:i=s.PAN;break;default:i=s.NONE}}var t=r!==s.NONE?r:i;if(t===s.ROTATE&&!c.noRotate){u.copy(T(e.pageX,e.pageY));l.copy(u)}else if(t===s.ZOOM&&!c.noZoom){m.copy(w(e.pageX,e.pageY));f.copy(m)}else if(t===s.PAN&&!c.noPan){E.copy(w(e.pageX,e.pageY));b.copy(E)}H.addEventListener("mousemove",C,false);H.addEventListener("mouseup",P,false);c.dispatchEvent(O)}function C(e){if(c.enabled===false)return;e.preventDefault();e.stopPropagation();var t=r!==s.NONE?r:i;if(t===s.ROTATE&&!c.noRotate){l.copy(u);u.copy(T(e.pageX,e.pageY))}else if(t===s.ZOOM&&!c.noZoom){f.copy(w(e.pageX,e.pageY))}else if(t===s.PAN&&!c.noPan){b.copy(w(e.pageX,e.pageY))}}function P(e){if(c.enabled===false)return;e.preventDefault();e.stopPropagation();i=s.NONE;H.removeEventListener("mousemove",C);H.removeEventListener("mouseup",P);c.dispatchEvent(j)}function A(e){if(c.enabled===false)return;if(c.noZoom===true)return;e.preventDefault();e.stopPropagation();switch(e.deltaMode){case 2:m.y-=e.deltaY*.025;break;case 1:m.y-=e.deltaY*.01;break;default:m.y-=e.deltaY*25e-5;break}c.dispatchEvent(O);c.dispatchEvent(j)}function D(e){if(c.enabled===false)return;e.preventDefault();switch(e.touches.length){case 1:i=s.TOUCH_ROTATE;u.copy(T(e.touches[0].pageX,e.touches[0].pageY));l.copy(u);break;default:i=s.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX;var o=e.touches[0].pageY-e.touches[1].pageY;g=v=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2;var a=(e.touches[0].pageY+e.touches[1].pageY)/2;E.copy(w(n,a));b.copy(E);break}c.dispatchEvent(O)}function R(e){if(c.enabled===false)return;e.preventDefault();e.stopPropagation();switch(e.touches.length){case 1:l.copy(u);u.copy(T(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX;var o=e.touches[0].pageY-e.touches[1].pageY;g=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2;var a=(e.touches[0].pageY+e.touches[1].pageY)/2;b.copy(w(n,a));break}}function M(e){if(c.enabled===false)return;switch(e.touches.length){case 0:i=s.NONE;break;case 1:i=s.TOUCH_ROTATE;u.copy(T(e.touches[0].pageX,e.touches[0].pageY));l.copy(u);break}c.dispatchEvent(j)}function z(e){if(c.enabled===false)return;e.preventDefault()}this.dispose=function(){this.domElement.removeEventListener("contextmenu",z,false);this.domElement.removeEventListener("mousedown",L,false);this.domElement.removeEventListener("wheel",A,false);this.domElement.removeEventListener("touchstart",D,false);this.domElement.removeEventListener("touchend",M,false);this.domElement.removeEventListener("touchmove",R,false);H.removeEventListener("mousemove",C,false);H.removeEventListener("mouseup",P,false);S.removeEventListener("keydown",k,false);S.removeEventListener("keyup",N,false)};this.domElement.addEventListener("contextmenu",z,false);this.domElement.addEventListener("mousedown",L,false);this.domElement.addEventListener("wheel",A,false);this.domElement.addEventListener("touchstart",D,false);this.domElement.addEventListener("touchend",M,false);this.domElement.addEventListener("touchmove",R,false);S.addEventListener("keydown",k,false);S.addEventListener("keyup",N,false);this.handleResize();this.update()};o.prototype=Object.create(t.prototype);o.prototype.constructor=o;return{TrackballControls:o}}